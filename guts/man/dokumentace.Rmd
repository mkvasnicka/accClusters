---
title: "Dokumentace systému pro vizualizaci dopravních nehod"
output: 
  pdf_document: 
    toc: yes
    fig_caption: yes
    number_sections: yes
    keep_tex: no
    pandoc_args: --highlight-style=dokumentace.theme
header-includes:
   - \usepackage{babel}
   - \usepackage{indentfirst}
   - \usepackage[utf8]{inputenc}
   - \usepackage[T1]{fontenc}
   - \usepackage{charter}
   - \usepackage[charter]{mathdesign}
   - \usepackage[scaled]{berasans}
   - \selectlanguage{czech}
   - \captionsczech
   - \renewcaptionname{czech}{\contentsname}{Obsah}
   - \addtokomafont{section}{\clearpage}
   - \let\OriMakeTitle\maketitle
   - \def\maketitle{\OriMakeTitle\vskip1\baselineskip\includegraphics[width=\linewidth]{fuze.pdf}\vskip11\baselineskip Software byl vytvořen týmem Masarykovy univerzity s~podporou grantu TAČR TL02000122 {\em Systém pro podporu rozhodování při posuzování fúzí na trzích s\ homogenním produktem a prostorovou diferenciací}.\thispagestyle{empty}}
   - \pagestyle{empty}
   - \tolerance=4500
   - \emergencystretch=11pt
documentclass: scrartcl
classoption: a4paper
fontsize: 11pt
geometry: left=25mm, right=25mm, top=25mm, bottom=40mm
---

<!--
Návod k nastavení LaTeXové třídy scrartcl je zde:
http://mirrors.ibiblio.org/CTAN/macros/latex/contrib/koma-script/doc/scrguien.pdf

Návod k nastavení barevného zvýraznění kódu:
https://community.rstudio.com/t/edit-tango-highlight/39106/2

Jak nastavit barevné zvýraznění v YAML:
https://stackoverflow.com/questions/24682878/set-highlight-style-from-pandoc-yaml-front-matter

Příklady vestavěného barevného zvýraznění kódu:
https://www.garrickadenbuie.com/blog/pandoc-syntax-highlighting-examples/
-->
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, dev = 'png', dpi = 600)
```

```{r packages, echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
library(knitr)
```



\newpage
\pagestyle{plain}
\setcounter{page}{1}



# Úvod

Tento text popisuje instalaci a použití softwaru

sw má dvě části:

- přípravu dat
- interaktivní shiny aplikaci





# Příprava dat

Tato kapitola popisuje, jaké hardwarové a softwarové vybavení je potřeba, jak software **XYZ** nainstalovat a jakou adresářovou strukturu software předpokládá.



## Potřebná konfigurace hardwaru a softwaru {#sec:hw-sw-config}

Výpočty jsou poměrně hardwarově náročné. Proto se předpokládá následující konfigurace hardwaru a softwaru:

- procesor třídy i5 nebo vyšší, minimálně 8\ jader (větší počet jader je výhodou),
- minimálně 32\ GB operační paměti (více jader vyžaduje více operační paměti),
- operační systém **TODO**,
- **TODO**



## Instalace softwaru


konfigurace




## Struktura vstupních dat {#kap:input-data}

Adresářová struktura je pevná. Všechna data (vstupní, výstupní, mezivýpočty, konfigurace, logy) jsou umístěny v jednom adresáři. V\ tomto adresáři jsou následující podadresáře:

- `config` ... adresář s\ konfigurací (`config.R`) a profily (`profile_XXX.R`)
- `rawdata` ... adresář se vstupními daty
- `data` ... adresář s\ mezivýpočty
- `output` ... aresář s\ výslednými/výstupními daty
- `log` ... adresář s\ logy


Software **XYZ** vyžaduje tři datové vstupy:

- mapový podklad o administrativním členění ČR,
- mapový podklad silniční sítě\ -- používá se OpenStreetMap (`czech-republic-latest.osm.pbf`) a
- popis jednotlivých dopravních nehod ve formátu CSV.

Všechna tato vstupní data je třeba umístit do následujících adresářů:

- administrativní členění: `RAW_DATA_DIR/acrcr/arccr_4_1.gdb/`,
- silniční síť OSM: `RAW_DATA_DIR/osm/czech-republic-latest.osm.pbf` a
- nehody: `RAW_DATA_DIR/accidents/`,

kde cestu k\ těmto adresářům můžete nastavit v\ konfiguračním souboru pomocí proměnné `RAW_DATA_DIR`. Pokud ji nenastavíte, použije se implicitní cesta `DIR_ORIGIN/rawdata`, kde `DIR_ORIGIN` je společná počáteční cesta ke všem datům systému **XYZ**.


### ARC ČR: Administrativní členění ČR

Mapový podklad pro administrativní členění připravuje firma ARCDATA Praha (https://www.arcdata.cz/). Systém **XYZ** využívá verzi ARC\ ČR\ 4.1, která je k\ dispozici ke stažení zdarma na adrese https://www.arcdata.cz/produkty/geograficka-data/arccr-4-0.

Stáhněte soubor `ArcČR_4_1.ppkx`, rozzipujte jej (v\ závislosti na operačním systému může vyžadovat změnu koncovky jména souboru na `.zip`), přesuňte podadresář `arccr_4_1/p20/arcčr_4_1.gdb` do adresáře `RAW_DATA_DIR/acrcr` a přejmenujte adresář na `arccr_4_1.gdb` (tj.\ odstraňte háček nad "č").

Tento soubor je vhodné změnit vždy, když se změní hranice okresů ČR. Po aktualizace mapy okresů je třeba aktualizovat všechna data, viz oddíl\  \ref{sec:aktutalizace-dat}.


### OpenStreetMap

Silniční síť OpenStreetMaps musí být zabalena do jednoho souboru typu `.osm.pbf`. Předpokládá se využití mapového podkladu sbaleného firmou GEOFABRIC (https://www.geofabrik.de/), který obsahuje nejnovější podobu silniční sítě v\ ČR.

Soubor najdete ke stažení na adrese https://download.geofabrik.de/europe/czech-republic.html; stahujte první odkaz (https://download.geofabrik.de/europe/czech-republic-latest.osm.pbf, "suitable for Osmium, Osmosis, imposm, osm2pgsql, mkgmap, and others".) Soubor vložte do adresáře `RAW_DATA_DIR/osm`.

Předpokládá se, že silniční síť je v\ systému **XYZ** třeba akutalizovat pouze jednou za několik let. Po aktualizace mapy silniční sítě je třeba aktualizovat všechna data, viz oddíl\  \ref{sec:aktutalizace-dat}.


### Data o nehodách

Data o\ nehodách je třeba umístit do adresáře `RAW_DATA_DIR/accidents` ve formátu CSV. Data pro každý rok se skládají ze souborů

- `####_databaze_nehody.csv`,
- `####_databaze_GPS.csv`,
- `####_databaze_nasledky.csv`,
- `####_databaze_vozidla.csv` a
- `####_databaze_chodci.csv`,

kde `####` představuje daný rok (např.\ 2021).




## Průběžně vytvářená data



## Výstupy systému



## Spuštění systému {#sec:aktutalizace-dat}





# Shiny applikace
