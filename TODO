TODO
====

+ TODO comment v functions_map_preparation.R
+ TODO comment v functions_cluster_preparation.R


Bugs
----
- accidents se aktualizují pokaždé -- asi chyba v závislostech -- v kódu chybu nevidím -- ještě ověřit, až doběhne
- u adaptivního výpočtu NKDE je někde problém -- zapisuje to nesmyslně velká data (stovky GB místo stovek MB)
    - přitom by to mělo být bez komprese vždycky stejně velké bez ohledu na způsob výpočtu NKDE
        - liší se jen hodnoty double hustot, ale jejich počet a všechno ostatní by mělo být stejné
            - načítá se to z lixelů, jejich středů apod.


Funkcionalita
-------------
- balancování zátěže
    - buď v PWALK, nebo před to
    - seřadit okresy tak, aby se jel vždycky celý profil dohromady, pak podle data, ... -- aby se nikdy nejel stejný okres naráz 2x
    - okresy seřadit podle jejich velikosti (počtu lixelů)
    - to vyžaduje se někam uložil počet lixelů
        - buď se musí načít všechny tabulky lixelů a uložit to z toho
        - nebo při tvorbě lixelů změni PWALK na PMAP a uložit to
        - nebo mít někde nějaké pišvejcovy konstanty
        - nebo vzít už z velikosti mapy
- hotovo -- zkontrolovat:
    - aktualizovat všechny balíky a vyzkoušet


Parametrizace
-------------
- najít optimální nastavení parametrů
    - podívat se, jak se liší klastry pro continuous a discontinuous
    - podívat se, co dělá adaptive
    - podívat se, co dělá bandwidth
    - podívat se, co dělá cost
    - podívat se, jak se liší klastry mezi obdobími pro různá nastavení (stabilnější je asi lepší)
    - rozmyslet si i délku období -- jsou 3 roky dost? -- klastry se mezi obdobími dost liší (Brno venkov)


Testovat
--------
- zkontrolovat závislosti v is_behind() a districts_behind()
- jaké sloupce obsahuje tabulka nehod + ty, které používáme, standardizovat
    - pro případ, že policie sloupce přejmenuje -- není kulturní, abychom používali jejich interní značky
    - nutné domluvit se Štěpánem, co z toho použije
        - data by to mělo chystat i pro něj -- aby se vzala data z guts a šoupla do shiny app
- při exportu do shiny ořezat lixely a klastry na okres -- asi už je -- zkontrolovat
    - lixely nechat jen ty, které jsou uvnitř skutečného okresu
    - klastry nechat celé, které aspoň částí zasahují do okresu
- zkontrolovat grid_shape v NKDE
    - NKDE i v nové verzi padalo, když tam byl rok 2022
- otestovat novou verzi densities
- pro všechny okresy:
    - zkontrolovat počet souvislých podgrafů
    - spustit kontrolu, o které psal Gelb
- Brno-venkov -- kdy se vyhodí Brno město? budou tam pak vůbec nějaké klastry?
    - podívat se, jak se počítá
    - klastrů je tam při současném nastavení docela dost


Nehody 2022
-----------
- zkontrolovat nehody za 2022
    - souřadnice + zbytek CSV
    - .rds


Čištění
-------
- vyhodit nepoužívané soubory/adresáře
- vyhodit:
    - unit_cost(s)()
- vyhodit testovací kód z functions_map_preparation.R
- do hlaviček prepare_*.R přidat, který soubory to vyžaduje a které vytváří
